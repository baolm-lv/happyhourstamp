<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1.0, maximum-scale=2.0">
	<title>Eureka</title>
	<link rel="stylesheet" href="/lib/bootstrap/3.3.6/css/bootstrap.min.css">
	<script src="/lib/jquery/1.12.0/jquery.min.js"></script>
</head>
<body>
	<nav class="navbar navbar-inverse">
		<div class="container">
			<div class="navbar-header">
				<a class="navbar-brand" href="">HHS-Service</a>
			</div>
			<div id="navbar" class="collapse navbar-collapse">
				<ul class="nav navbar-nav">
					<li class=""><a href="services.html">服务管理</a></li>
					<li class="active"><a href="eureka.html">Eureka</a></li>
					<li class=""><a href="metrics.html">Metrics</a></li>
				</ul>
			</div>
		</div>
	</nav>
	<div id="container" class="container"></div>
</body>
<script type="text/javascript">
$(document).ready(function() {
	$.ajax({
		url : "/mgt/eureka/instance",
		contentType : "application/json",
		type : "get"
	}).done(function(result){
		createEurekaInstanceTable(result);
	}).fail(function(){
		alert("操作失败");
	});
	
	$("#container").on("click", "button.statusBtn", function(){
		var status = "UP";
		if($(this).attr("status") == "UP")
			status = "OUT_OF_SERVICE";
		
		$.ajax({
			url : "/mgt/eureka/status",
			contentType : "application/json",
			data : JSON.stringify({"status": status}),
			type : "POST"
		}).done(function(result){
			createEurekaInstanceTable(result);
		}).fail(function(){
			alert("操作失败");
		});
	});
	
	function createEurekaInstanceTable(d) {
		$("#container").html(createStatusHeader(d));
		$("#container").append(createStatusTable(d));
	}
	function createStatusTable(d) {
		var table = '<table class="table table-striped table-bordered">' +
					'<tr>'+
						'<td>Host Name:</td>'+
						'<td>'+d.hostName+'</td>'+
					'</tr>'+
					'<tr>'+
						'<td>App Name:</td>'+
						'<td>'+d.app+'</td>'+
					'</tr>'+
					'<tr>'+
						'<td>Ip Address:</td>'+
						'<td>'+d.ipAddr+'</td>'+
					'</tr>'+
					'<tr>'+
						'<td>Vip Address:</td>'+
						'<td>'+d.vipAddress+'</td>'+
					'</tr>'+
					'<tr>'+
						'<td>Port:</td>'+
						'<td>'+d.port+'</td>'+
					'</tr>'+
					'<tr>'+
						'<td>Home Page:</td>'+
						'<td><a href="'+d.homePageUrl+'">'+d.homePageUrl+'</a></td>'+
					'</tr>'+
					'<tr>'+
						'<td>Status Page:</td>'+
						'<td><a href="'+d.statusPageUrl+'">'+d.statusPageUrl+'</a></td>'+
					'</tr>'+
					'<tr>'+
						'<td>Health Check Page:</td>'+
						'<td><a href="'+d.healthCheckUrl+'">'+d.healthCheckUrl+'</a></td>'+
					'</tr>'+
					'</table>';
		return table;
	}
	
	function createStatusHeader(d) {
		var status = '<div class="row">'+
						'<div class="col-md-6"><h1><small>服务状态:</small>'+d.status+'</h1></div>'+
						'<div class="col-md-6">'+
							'<h1><small>停用/启用: </small>'+
							'<button class="btn btn-warning statusBtn" status="'+d.status+'">'+ (d.status == "UP" ? '停用' : '启用') +'</button></h1>'+
						'</div>'+
					'</div>';
		return status;
	}
});
</script>
</html>